@page "/upload"
@using System.Drawing;
@using System.Text;
@using ImageProcessing;

<PageTitle>Test wczytywania plików</PageTitle>

<h1>Naciśnij, aby wczytać</h1>

<InputFile OnChange="@LoadFiles"
    multiple 
    draggable="true" 
    accept=".png,.jpg,.jpeg"/>

@if (images is {})
{
    <table>
    @for (int i = 0; i < images.Count; i += 3)
    {
        <tr>
            @for (int j = 0; j < 3 && i + j < images.Count; j++)
            {
                string base64 = images[i + j];
                <td>                      
                    <img 
                        src=@base64
                        alt="student"
                        title=@base64.Length/>
                </td>
            }
        </tr>
    }
    </table>
}

@code{
    private List<string> images = new();

    private async Task LoadFiles(InputFileChangeEventArgs e)
    {
        images.Clear();
        var maxFiles = e.FileCount;
        var files = e.GetMultipleFiles(maxFiles);

        foreach (var file in files)
        {
            var scaledImage = await Scale(file);
            var base64 = await FileConverter.BrowserFileToBase64Async(scaledImage);
            images.Add(base64);
        }

        StateHasChanged();

        ValueTask<IBrowserFile> Scale(IBrowserFile f) 
            => BrowserFileImageScaler.GetScaleTask(f, 400, 400);
    }
}
